{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <!-- Back to Home Button -->
        <a href="{% url 'home' %}" class="btn btn-primary">Back to Home</a>

        <!-- Title -->
        <h1 class="text-primary text-center w-100">Top Selling Products</h1>
    </div>

    <!-- Search Form -->
    <div class="mb-4">
        <input type="text" id="productSearch" class="form-control" placeholder="Search Products..." onkeyup="searchProducts()">
    </div>

    <!-- List of top-selling products -->
    <table class="table table-hover">
        <thead>
            <tr>
                <th>S.NO</th>
                <th>Product Name</th>
                <th>Total Sold</th>
                <th>Sold Today</th>
            </tr>
        </thead>
        <tbody id="productList">
            {% for product in top_selling_products %}
                <tr class="product-card">
                    <td>{{ forloop.counter }}</td> <!-- Serial number -->
                    <td class="product-name">{{ product.name }}</td>
                    <td>{{ product.total_sold|floatformat:3 }}</td>
                    <td>{{ product.day_sold|floatformat:3 }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- No Results Message -->
    <div class="no-results" id="noResultsMessage" style="display:none;">
        <p>No products matched your search criteria.</p>
    </div>

</div>

<!-- JavaScript to handle filtering of the product list -->
<script>
    function searchProducts() {
        const input = document.getElementById('productSearch').value.toLowerCase();  // Get the search query
        const productCards = document.querySelectorAll('.product-card');  // Get all product rows
        const noResults = document.getElementById('noResultsMessage');  // Get no results message

        let hasVisibleItems = false;

        // Show all products if the input is empty
        if (input.length === 0) {
            productCards.forEach(card => {
                card.style.display = 'table-row';  // Show all rows
            });
            noResults.style.display = 'none';  // Hide the "no results" message
            return;  // Exit the function early
        }

        // Hide all product items initially
        productCards.forEach(card => {
            card.style.display = 'none';  // Hide all rows initially
        });

        // Show matching products
        productCards.forEach(card => {
            const productName = card.querySelector('.product-name').textContent.toLowerCase();  // Get product name
            if (productName.startsWith(input)) {
                card.style.display = 'table-row';  // Show matching row
                hasVisibleItems = true;
            }
        });

        // Show or hide the no results message based on search results
        if (hasVisibleItems) {
            noResults.style.display = 'none';  // Hide "no results" message
        } else {
            noResults.style.display = 'block';  // Show "no results" message
        }
    }
</script>

{% endblock %}
